import io from 'socket.io-client';

console.log('🤖 Testing AI-Generated God Mode Mod\n');

// This is the exact code Gemini generated
const aiGeneratedCode = `// PERSISTENT
// God mode: Makes the player invulnerable and keeps health/armor at max.
const player = api.getMyPlayer();

// Ensure the player exists and is still alive before applying effects
if (player && player.health > 0) {
  // Set the player as invulnerable
  api.setInvulnerable(player.id, true);
  // Keep health at 100
  api.setHealth(player.id, 100);
  // Keep armor at 100
  api.setArmor(player.id, 100);
}`;

const socket = io('http://localhost:5500');

socket.on('connect', () => {
  console.log('✅ Connected to server:', socket.id);
  console.log('👤 Joining as AI_Test_Player...\n');
  socket.emit('join', 'AI_Test_Player');
});

socket.on('init', (data) => {
  console.log('✅ Joined game successfully');
  console.log(`   Player ID: ${data.playerId}\n`);

  console.log('🤖 Activating AI-generated god mode mod...');
  console.log('📝 Code generated by Gemini AI:');
  console.log('─'.repeat(60));
  console.log(aiGeneratedCode);
  console.log('─'.repeat(60));
  console.log();

  socket.emit('activatePersistentMod', {
    code: aiGeneratedCode,
    durationMs: 30000, // 30 seconds
    name: 'AI-Generated God Mode',
    description: 'God mode created by Gemini AI'
  });
});

socket.on('persistentModResult', (result) => {
  if (result.success) {
    console.log('✅ AI-GENERATED MOD ACTIVATED SUCCESSFULLY!');
    console.log(`   Mod ID: ${result.modId}`);
    console.log(`   Duration: ${result.duration}ms (${result.duration/1000}s)`);
    console.log(`   Message: ${result.message}\n`);
    console.log('🛡️  Player is now invulnerable with full health/armor!');
    console.log('⚡ Running every game tick (60 times/second)...\n');

    setTimeout(() => {
      console.log('✅ Test complete!');
      console.log('💡 The Gemini AI successfully generated working god mode code!');
      socket.disconnect();
      process.exit(0);
    }, 3000);
  } else {
    console.log('❌ Failed to activate mod:', result.error);
    socket.disconnect();
    process.exit(1);
  }
});

socket.on('disconnect', () => {
  console.log('🔌 Disconnected from server');
});

socket.on('error', (error) => {
  console.error('❌ Socket error:', error);
});
